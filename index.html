<!DOCTYPE html>
<html>

<head>
  <title>Geckos 7</title>
  <link rel="stylesheet" href="styles.css">
  <script src="map.js" type="text/javascript"></script>

  <script>

  function init() {

  	// defining canvas
  	var canvas = document.getElementById("canvas");
  	canvas.width = 800;
  	canvas.height = 600;
  	var c = canvas.getContext("2d");
  	var WIDTH = canvas.width;
  	var HEIGHT = canvas.height;
  	var keys = [];
  	var requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;
  	window.requestAnimationFrame = requestAnimationFrame;
  	var tileSize = 25;
  	var mapSize = {
  		h: (map.length * tileSize),
  		w: (map[0].length * tileSize),
  	}

  	// construct a player
  	 function Player () {
  		this.x = 400;
  		this.y = 300;
  		this.w = 10;
  		this.h = 10;
  		this.speed = 5;
  	 }
  	var Player1 = new Player();

  	//create the camera
  	var camera = {
  		x: 0,
  		y: 0,
  		w: 800,
  		h: 600
  	};

  	// set the game loop interval
  	setInterval(mainDraw, 20);

  	function playerDraw() {
  		c.fillStyle="red";
  		c.strokeStyle="blue";
  		c.beginPath();
  		c.rect(Player1.x - (Player1.w / 2) - camera.x, Player1.y - (Player1.h / 2) - camera.y, Player1.w, Player1.h);
  		c.lineWidth=1;
  		c.stroke();
  		c.fill();
  	}

  	function updateCamera() {
  		if ( Player1.x > (camera.w / 2) && Player1.x < mapSize.w - (camera.w / 2) ) {
  			camera.x = Player1.x - (camera.w / 2);
  		}
  		if ( Player1.y > (camera.h / 2) && Player1.y < mapSize.h - (camera.h / 2) ) {
  			camera.y = Player1.y - (camera.h / 2);
  		}
  	}

  	function drawMap() {
  	var onXTile = Math.floor((camera.x + (camera.w / 2)) / tileSize);
  	var onYTile = Math.floor((camera.y + (camera.h / 2)) / tileSize);
  	c.beginPath();
  		for (j = onYTile - 13; j < onYTile + 13; j++ ) {
  			for (l = onXTile - 17; l < onXTile + 17; l++) {
  				if (j >= 0 && l >= 0 && j < map.length && l < map[j].length) {
  				c.fillStyle = map[j][l];
  				c.fillRect(l * tileSize - camera.x, j * tileSize - camera.y, tileSize, tileSize);
  				} // check tile is in bounds
  			} // for loop - x axis
  		} // for loop - y axis
  	}

  	function mainDraw() {
  		c.clearRect(0, 0, WIDTH, HEIGHT);
  		playerMove();
  		updateCamera();
  		drawMap();
  		playerDraw();
  	} //mainDraw

  	function playerMove(e){
  		if (keys[87]) {
  			Player1.y -= Player1.speed;
  			if (Player1.y - (Player1.h / 2) < camera.y) {
  				Player1.y = camera.y + (Player1.h / 2);
  			}
  		}
  		if (keys[83]) {
  			Player1.y += Player1.speed;
  			if (Player1.y + (Player1.h / 2) >= camera.y + camera.h) {
  				Player1.y = camera.y + camera.h - (Player1.h / 2);
  			}
  		}
  		if (keys[65]) {
  			Player1.x -= Player1.speed;
  			if (Player1.x - (Player1.w / 2) < camera.x) {
  				Player1.x = camera.x + (Player1.w / 2);
  			}
  		}
  		if (keys[68]) {
  			Player1.x += Player1.speed;
  			if (Player1.x + (Player1.w / 2) >= mapSize.w) {
  				Player1.x = camera.x + camera.w - (Player1.w / 2);
  			}
  		}
  		return false;
  	}

  	canvas.addEventListener("keydown", function (e) {
  		keys[e.keyCode] = true;
  	});
  	canvas.addEventListener("keyup", function (e) {
  		keys[e.keyCode] = false;
  	});
  } // init


  </script>

</head>

<body onload="init()">
  <div id="holder">
    <canvas id="canvas" width="800" height="600" tabindex="1"></canvas>
  </div>


</body>

</html>
